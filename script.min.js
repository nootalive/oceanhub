(function(){'use strict';function initNavigation(){const navToggle = document.querySelector('.nav-toggle');const navMenu = document.getElementById('nav-menu');const navLinks = document.querySelectorAll('.nav-link');if(!navToggle || !navMenu)return;navToggle.addEventListener('click',()=>{const isExpanded = navToggle.getAttribute('aria-expanded')=== 'true';navToggle.setAttribute('aria-expanded',!isExpanded);navMenu.classList.toggle('active',!isExpanded);});navLinks.forEach(link =>{link.addEventListener('click',()=>{navToggle.setAttribute('aria-expanded','false');navMenu.classList.remove('active');});});document.addEventListener('keydown',(e)=>{if(e.key === 'Escape' && navToggle.getAttribute('aria-expanded')=== 'true'){navToggle.setAttribute('aria-expanded','false');navMenu.classList.remove('active');navToggle.focus();}});document.addEventListener('click',(e)=>{if(!navToggle.contains(e.target)&& !navMenu.contains(e.target)){navToggle.setAttribute('aria-expanded','false');navMenu.classList.remove('active');}});}function initDiscordTracking(){const discordLinks = document.querySelectorAll('[data-track="discord-nav"],[data-track="discord-hero"],[data-track="discord-coins"],[data-track="discord-community"]');discordLinks.forEach(link =>{link.addEventListener('click',(e)=>{const source = link.getAttribute('data-track');trackDiscordClick(source);});});}function trackDiscordClick(source){if(window.cookieManager && window.cookieManager.hasConsent('analytics')){if(window.gtag){window.gtag('event','discord_click',{event_category:'engagement',event_label:source,value:1});}if(window.plausible){window.plausible('Discord Click',{props:{source:source}});}console.log(`[Analytics] Discord click tracked:${source}`);}else{console.log(`[No Consent] Discord click(not tracked):${source}`);}}async function loadShop(){const shopContainer = document.getElementById('shop-container');if(!shopContainer)return;try{const response = await fetch('./data/shop.json');if(!response.ok)throw new Error('Shop data not found');const shopData = await response.json();renderShop(shopData);}catch(error){console.error('Failed to load shop:',error);shopContainer.innerHTML = ` <div class="shop-loading"> <p>Shop momentaneamente non disponibile. Riprova piÃ¹ tardi.</p> </div> `;}}function renderShop(shopData){const shopContainer = document.getElementById('shop-container');if(!shopContainer || !shopData.items)return;const shopHTML = ` <h3 style="margin-bottom:var(--spacing-lg);font-size:var(--font-size-2xl);">Premi Disponibili</h3> <div class="shop-items"> ${shopData.items.map(item => ` <div class="shop-item"> <div class="shop-item-info"> <h4>${item.name}</h4> <p>${item.description}</p> </div> <div class="shop-item-price"> ${item.price.toLocaleString()}ðŸ’° </div> </div> `).join('')}</div> <p style="margin-top:var(--spacing-lg);color:var(--text-muted);font-size:var(--font-size-sm);text-align:center;"> Per riscattare un premio,apri un ticket in <strong>ãƒ»ðŸŽ«ï¸²ticket PERKS</strong> </p> `;shopContainer.innerHTML = shopHTML;}function initSmoothScroll(){document.querySelectorAll('a[href^="#"]').forEach(anchor =>{anchor.addEventListener('click',function(e){const href = this.getAttribute('href');if(href === '#')return;e.preventDefault();const target = document.querySelector(href);if(target){const navbarHeight = document.querySelector('.navbar')?.offsetHeight || 0;const targetPosition = target.getBoundingClientRect().top + window.pageYOffset - navbarHeight - 20;window.scrollTo({top:targetPosition,behavior:'smooth'});}});});}function initLazyLoading(){if('IntersectionObserver' in window){const imageObserver = new IntersectionObserver((entries,observer)=>{entries.forEach(entry =>{if(entry.isIntersecting){const img = entry.target;if(img.dataset.src){img.src = img.dataset.src;img.removeAttribute('data-src');}observer.unobserve(img);}});});document.querySelectorAll('img[data-src]').forEach(img =>{imageObserver.observe(img);});}else{document.querySelectorAll('img[data-src]').forEach(img =>{img.src = img.dataset.src;img.removeAttribute('data-src');});}}function initScrollToTop(){const scrollBtn = document.getElementById('scroll-to-top');if(!scrollBtn)return;window.addEventListener('scroll',()=>{if(window.pageYOffset > 300){scrollBtn.classList.add('show');}else{scrollBtn.classList.remove('show');}});scrollBtn.addEventListener('click',()=>{window.scrollTo({top:0,behavior:'smooth'});});}function handleExternalWidgets(){window.addEventListener('cookieConsentGiven',(e)=>{const preferences = e.detail;if(preferences.marketing){loadDiscordWidget();}});if(window.cookieManager && window.cookieManager.hasConsent('marketing')){loadDiscordWidget();}}function loadDiscordWidget(){const widgetContainer = document.getElementById('discord-widget');if(!widgetContainer)return;console.log('Discord widget would load here(marketing consent given)');}function initFormValidation(){const forms = document.querySelectorAll('form[data-validate]');forms.forEach(form =>{form.addEventListener('submit',(e)=>{if(!form.checkValidity()){e.preventDefault();e.stopPropagation();}form.classList.add('was-validated');});});}function initScrollAnimations(){if(!('IntersectionObserver' in window))return;const animateOnScroll = new IntersectionObserver((entries)=>{entries.forEach(entry =>{if(entry.isIntersecting){entry.target.classList.add('animate-in');}});},{threshold:0.1,rootMargin:'0px 0px -50px 0px'});document.querySelectorAll('.feature-card,.info-card,.shop-item').forEach(el =>{animateOnScroll.observe(el);});}function getCookie(name){const match = document.cookie.match(new RegExp('(^|)' + name + '=([^;]+)'));return match ? match[2]:null;}function formatNumber(num){return num.toLocaleString('it-IT');}function init(){console.log('OceanHub - Initializing...');initNavigation();initDiscordTracking();initSmoothScroll();initLazyLoading();loadShop();handleExternalWidgets();initScrollToTop();initFormValidation();initScrollAnimations();console.log('OceanHub - Ready!');}if(document.readyState === 'loading'){document.addEventListener('DOMContentLoaded',init);}else{init();}window.OceanHub ={trackDiscordClick,formatNumber,getCookie};})();